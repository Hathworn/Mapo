// Use early return to reduce unnecessary checks and improve performance
// Replace isnan with fpclassify for potential performance gain