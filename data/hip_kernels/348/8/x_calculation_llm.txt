```c
// Use shared memory to cache r and reduce global memory accesses
// Ensure coalesced memory accesses to x and r for better performance
// Minimize divergent branching by using conditional operator instead of if
```