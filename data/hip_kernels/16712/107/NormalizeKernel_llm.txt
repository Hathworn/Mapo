// Optimize index calculation by minimizing arithmetic operations
// Combine boundary check and processing to reduce branching
// Avoid recalculating 'pos' by storing the value early
// Use a conditional approach to prevent division by zero and simplify scaling operation