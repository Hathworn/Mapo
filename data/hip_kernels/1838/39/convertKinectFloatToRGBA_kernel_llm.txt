```cpp
// Consider coalesced memory access by restructuring data storage
// Avoid using pointer arithmetic for accessing in_image values
// Minimize branching for performance optimization
// Use shared memory if possible to reduce global memory access
// Prefetch data to reduce memory latency
// Optimize calculations by reusing computed values
```