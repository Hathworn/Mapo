// Cache thread ID calculations in registers for performance.
// Ensure computations are only performed for valid indices.
// Precompute shared index calculations to reduce redundant computation.
// Optimize calculation by reducing repeated operations.
// Use precomputed weighted sum to update z.