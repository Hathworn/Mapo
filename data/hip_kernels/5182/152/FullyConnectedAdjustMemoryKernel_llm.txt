```cpp
// Use pre-calculated threshold for efficiency
// Ensure coalesced memory access by iterating over i in the inner loop
// Minimize divergent branches within the loop
// Prefetch global memory accesses outside of the critical loops
```