// Use restrict keyword for pointers to improve memory access performance
// Cache the index calculation to avoid recalculation
// Reorganize logic to remove branch divergence