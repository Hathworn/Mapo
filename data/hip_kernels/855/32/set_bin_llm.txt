// Use atomicMax on shared memory to prevent contention
// Improved iteration to minimize branching