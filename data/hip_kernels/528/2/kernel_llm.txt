```cpp
// Cache adj_mat and visited values to reduce global memory accesses
// Use a single conditional check to improve data locality and avoid code duplication
```