// Optimize by calculating index only once
// Use intrinsic functions for better performance