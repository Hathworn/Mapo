// Unroll loop to improve performance.
// Optimize reduction using binary tree.
// Compute gradient, optimizing for memory coalescing.