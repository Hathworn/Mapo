```
// Optimize memory access by using shared memory for common calculations like x2, y2, and z2.
// Use loop unrolling in the for loop for improved performance.
// Consider using atomic operations to manage writing to idx array safely.
// Minimize divergent branches by leveraging logical operations.
// Pre-calculate radius squared for reduced computation inside the loop.
```