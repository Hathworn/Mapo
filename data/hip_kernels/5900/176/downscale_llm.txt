```cpp
// Use shared memory to cache gradOutput_data elements to reduce global memory accesses.
// Optimize the calculation of ipidx by moving repeated operations outside the inner loop.
```