// Use shared memory to minimize memory accesses
// Move linear update to use the same conditional block