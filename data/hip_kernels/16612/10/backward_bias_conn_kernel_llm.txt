// Simplify index calculation for better thread access patterns
// Use atomicAdd for thread safety and to avoid race conditions