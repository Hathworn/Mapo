// Use a single memory read for similarities to minimize access
// Use direct multiplication result storage
// Optimize updating the gradient to avoid branching