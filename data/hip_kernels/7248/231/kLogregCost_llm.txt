// Use intrinsic function for logarithm to improve performance
// Optimize condition check by avoiding unnecessary computations
// Use atomic operation to count max-prob labels in parallel
// Ensure division is done outside of loop for efficiency