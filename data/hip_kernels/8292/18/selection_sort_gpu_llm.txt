```cpp
// Use shared memory to further optimize memory access patterns
// Consider loop unrolling for the inner loops to improve performance
// Ensure the batch processing leverages hardware resources efficiently
// Optimize memory access for the 'dist' array to avoid redundant reads
// Use vectorized operations if applicable for further optimization
```